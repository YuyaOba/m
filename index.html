<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>„ÇÅ„Çã„ÇÇ„Ç≠„É£„ÉÉ„ÉÅÔºÅ„Çø„Ç§„É†„Ç¢„Çø„ÉÉ„ÇØ</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(180deg, #fff7fb 0%, #ffe6f0 100%);
      touch-action: none;
      font-family: "Zen Maru Gothic", sans-serif;
    }
    #score, #time, #stock {
      position: absolute;
      left: 14px;
      font-size: 22px;
      color: #ff66aa;
      text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
      user-select: none;
      font-weight: 600;
      letter-spacing: 1px;
    }
    #score { top: 10px; }
    #time { top: 42px; }
    #stock { top: 74px; }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: "Zen Maru Gothic", sans-serif; /* ‚Üê „Éï„Ç©„É≥„ÉàÁµ±‰∏Ä */
      font-size: 46px;
      color: #ff66aa;
      font-weight: bold;
      display: none;
      text-align: center;
      text-shadow: 3px 3px 6px rgba(255, 182, 193, 0.6);
      animation: pop 0.5s ease;
    }
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0.6); opacity: 0; }
      60% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    canvas {
      cursor: pointer;
    }
  </style>

  
</head>
<body>
  <!-- ‰∏∏„Åè„Å¶Áôñ„ÅÆ„Å™„ÅÑ„Éï„Ç©„É≥„Éà -->
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500&family=Potta+One&display=swap" rel="stylesheet">

  <div id="score">„Çπ„Ç≥„Ç¢Ôºö0</div>
  <div id="time">„ÅÆ„Åì„ÇäÔºö60Áßí</div>
  <div id="stock">„Çπ„Éà„ÉÉ„ÇØÔºö„ÇÅ0 „Çã0 „ÇÇ0</div>
  <div id="message"></div>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    let w = (canvas.width = window.innerWidth);
    let h = (canvas.height = window.innerHeight);

    const player = { 
      x: w / 2, 
      y: h - 70, 
      width: Math.min(w * 0.22, 80), 
      height: 16, 
      color: "#ff8ec8", 
      radius: 8 
    };

    const plusKana = ["„ÇÅ", "„Çã", "„ÇÇ"];
    const minusKana = ["„Å¨", "„Çç"];
    const allKana = [...plusKana, ...minusKana];

    let letters = [];
    let score = 0;
    let timeLeft = 60;
    let stock = { "„ÇÅ": 0, "„Çã": 0, "„ÇÇ": 0 };
    let gameActive = true;

    // üéµ „Éù„ÉÉ„ÉóÈü≥Ôºà„Åã„Çè„ÅÑ„ÅÑÂÆåÊàêÈü≥Ôºâ
    const popSound = new Audio("https://cdn.jsdelivr.net/gh/joshwcomeau/assets/sounds/pop.mp3");
    let soundEnabled = false;

    // ‚úÖ ÊúÄÂàù„ÅÆÊìç‰Ωú„ÅßÈü≥„ÇíÊúâÂäπÂåñ
    function enableSound() {
      if (!soundEnabled) {
        popSound.play().then(() => {
          popSound.pause();
          popSound.currentTime = 0;
          soundEnabled = true;
        }).catch(() => {});
      }
    }

    function showMessage(text, color = "#ff66aa") {
      const msg = document.getElementById("message");
      msg.textContent = text;
      msg.style.color = color;
      msg.style.display = "block";
      msg.style.animation = "pop 0.5s ease";
      setTimeout(() => (msg.style.display = "none"), 500);
    }

    function spawnLetter() {
      if (!gameActive) return;
      letters.push({
        x: Math.random() * (w - 40),
        y: -40,
        text: allKana[Math.floor(Math.random() * allKana.length)],
        speed: 2 + Math.random() * 3
      });
    }

    function drawRoundedRect(x, y, width, height, radius, color) {
      const grad = ctx.createLinearGradient(x, y, x, y + height);
      grad.addColorStop(0, "#ffb3de");
      grad.addColorStop(1, color);
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
      ctx.fill();
      ctx.shadowColor = "rgba(255, 182, 193, 0.5)";
      ctx.shadowBlur = 6;
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    function update() {
      ctx.clearRect(0, 0, w, h);
      drawRoundedRect(player.x - player.width / 2, player.y, player.width, player.height, player.radius, player.color);

      // ËêΩ„Å°„Å¶„Åè„ÇãÊñáÂ≠ó„ÅÆ„Éï„Ç©„É≥„Éà„Çí„ÇÑ„Åï„Åó„Åè‰∏∏„Åè
      ctx.font = "34px 'Zen Maru Gothic', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      for (let i = letters.length - 1; i >= 0; i--) {
        const l = letters[i];
        l.y += l.speed;
        ctx.fillStyle = plusKana.includes(l.text) ? "#ff66aa" : "#666";
        ctx.fillText(l.text, l.x, l.y);

        if (
          l.y + 20 > player.y &&
          l.x > player.x - player.width / 2 &&
          l.x < player.x + player.width / 2
        ) {
          const isMinus = minusKana.includes(l.text);
          const strictArea = player.width * 0.4; 
          const hitCenter = Math.abs(l.x - player.x) < strictArea / 2;
          if (isMinus && !hitCenter) continue;

          if (plusKana.includes(l.text)) {
            stock[l.text]++;
            showMessage(`${l.text}Ôºã`, "#ff66aa");
          } else {
            score = Math.max(0, score - 1);
            showMessage("Ôºç1", "#6699ff");
          }
          updateDisplay();
          letters.splice(i, 1);
        }

        if (l.y > h + 30) letters.splice(i, 1);
      }

      if (stock["„ÇÅ"] > 0 && stock["„Çã"] > 0 && stock["„ÇÇ"] > 0) {
        stock["„ÇÅ"]--; stock["„Çã"]--; stock["„ÇÇ"]--;
        score++;
        showMessage("„ÇÅ„Çã„ÇÇÂÆåÊàêÔºÅÔºã1‚ú®", "#ff3399");
        if (soundEnabled) {
          popSound.currentTime = 0;
          popSound.play().catch(() => {});
        }
        updateDisplay();
      }

      if (gameActive) requestAnimationFrame(update);
    }

    function updateDisplay() {
      document.getElementById("score").textContent = `„Çπ„Ç≥„Ç¢Ôºö${score}`;
      document.getElementById("stock").textContent =
        `„Çπ„Éà„ÉÉ„ÇØÔºö„ÇÅ${stock["„ÇÅ"]} „Çã${stock["„Çã"]} „ÇÇ${stock["„ÇÇ"]}`;
    }

    function countdown() {
      const timer = setInterval(() => {
        if (!gameActive) {
          clearInterval(timer);
          return;
        }
        timeLeft--;
        document.getElementById("time").textContent = `„ÅÆ„Åì„ÇäÔºö${timeLeft}Áßí`;
        if (timeLeft <= 0) {
          gameActive = false;
          document.getElementById("message").textContent = `ÁµÇ‰∫ÜÔºÅ„Çπ„Ç≥„Ç¢Ôºö${score}`;
          document.getElementById("message").style.display = "block";
          clearInterval(timer);
        }
      }, 1000);
    }

    // ‚úÖ ÊúÄÂàù„ÅÆÊìç‰Ωú„ÅßÈü≥„ÇíÊúâÂäπÂåñ
    window.addEventListener("touchstart", enableSound, { once: true });
    window.addEventListener("mousedown", enableSound, { once: true });

    window.addEventListener("touchmove", (e) => {
      player.x = e.touches[0].clientX;
    });
    window.addEventListener("mousemove", (e) => {
      player.x = e.clientX;
    });

    setInterval(spawnLetter, 800);
    update();
    countdown();
  </script>
</body>
</html>
